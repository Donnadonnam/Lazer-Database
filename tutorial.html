<!DOCTYPE HTML>
<html>

<head>
    <title>Lazer Database Tutorial</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600" rel="stylesheet" type="text/css" />
    <link href="http://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="http://yandex.st/highlightjs/7.5/styles/tomorrow.min.css">
    <script src="http://yandex.st/highlightjs/7.5/highlight.min.js"></script>
    <style>
        /* Eric Meyer's Reset CSS v2.0 - http://cssreset.com */
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:none}table{border-collapse:collapse;border-spacing:0} 
        /* Styles */
html { height: 100%; width: 100%; } body { font-family: Source Sans Pro; font-size: 20px; font-weight: 300; color: #373737; background: #373737; display:table; width: 100%; height: 100%; table-layout:fixed; } @media screen and (min-width: 800px) and (min-height: 380px) { #leftblock { width: 270px; height: 100%; display:table-cell; vertical-align: top; } #leftblock > div { width: 270px; position: fixed; height: 100%; } } @media screen and (max-width: 800px) { #leftblock { display: none; } } @media screen and (max-height: 380px) { #leftblock { width: 270px; height: 100%; display:table-cell; vertical-align: top; } #leftblock > div { width: 270px; height: 100%; } } @media screen and (max-width: 800px) and (max-height: 500px) { #leftblock { display: none; } } #content { padding: 20px 40px; background: white; display:table-cell; } h1 { color: #fff; font-size: 34px; font-weight: 200; margin-bottom: 40px; padding: 20px; } h2 { font-size: 32px; font-weight: 300; margin: 10px 0; color: #000; margin-left: -10px; } h3 { padding: 10px 5px; font-size: 17px; } p { padding: 5px; } p strong { font-weight: 600; color: #FF5500; } a { color: #000; text-decoration: none; } nav > ul li { line-height: 2.5em; text-align: right; } nav > ul li a { display: block; color: #fff; padding-right: 50px; } nav > ul li:hover { background: #222729; } hr { margin: 20px auto; border:0; height: 1px; background: #f0f0f0; width: 100%; } code { display: block; margin: 10px 25px !important; padding: 10px 20px !important; font-family: Inconsolata; font-size: 18px; background: #f9f9f9 !important; color: #373737 !important; border-left: 1px dashed #878787; word-wrap: break-word; } samp { display: block; margin: 0 25px; padding: 10px 20px; font-family: Inconsolata; font-size: 18px; background: #f9f9f9; border-left: 1px dashed #878787; } </style>
    <script>hljs.initHighlightingOnLoad();</script>
</head>

<body>
    <div id="leftblock">
        <div>
            <h1>Lazer Database Tutorial</h1>
            <nav>
                <ul>
                    <li>
                        <a href="#createTables">Create tables</a>
                    </li>
                    <li>
                        <a href="#createRelations">Create relations</a>
                    </li>
                    <li>
                        <a href="#addData">Add some data</a>
                    </li>
                    <li>
                        <a href="#finish">Display</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <div id="content">

        <h2>Welcome</h2>
        <p>In this tutorial we will create simple news system.</p>
        <hr />

        <h2 id="createTables">Create tables</h2>
        <p>First of all we must create our tables: Users, News, Comments, Tags:
        <h3>Code:</h3>
        <pre><code>require_once 'Lazer/bootstrap.php'; /* I will skip this line in rest of code samples */
use Lazer\Classes\Database as Lazer; /* I will skip this line in rest of code samples */

Lazer::create('users', array(
    'name' => 'string',
    'email' => 'string',
));

Lazer::create('news', array(
    'topic' => 'string',
    'content' => 'string',
    'author_id' => 'integer'
));

Lazer::create('comments', array(
    'content' => 'string',
    'author_id' => 'integer'
    'news_id' => 'integer'
));

Lazer::create('tags', array(
    'name' => 'string'
));</code></pre>
        <hr />
        
        <h2 id="createRelations">Create relations</h2>
        <p>Now we will create relations:</p>
        <h3>Code:</h3>
        <pre><code>use Lazer\Classes\Relation;

/* relations for News table */
Relation::table('news')-&gt;belongsTo('users')-&gt;localKey('author_id')-&gt;foreignKey('id')-&gt;setRelation();
Relation::table('news')-&gt;hasMany('comments')-&gt;localKey('id')-&gt;foreignKey('news_id')-&gt;setRelation();
Relation::table('news')-&gt;hasAndBelongsToMany('tags')-&gt;localKey('id')-&gt;foreignKey('id')-&gt;setRelation();

/* relations for Users table */
Relation::table('users')-&gt;hasMany('news')-&gt;localKey('id')-&gt;foreignKey('author_id')-&gt;setRelation();
Relation::table('users')-&gt;hasMany('comments')-&gt;localKey('id')-&gt;foreignKey('author_id')-&gt;setRelation();

/* relations for Comments table */
Relation::table('comments')-&gt;belongsTo('news')-&gt;localKey('author_id')-&gt;foreignKey('id')-&gt;setRelation();
Relation::table('comments')-&gt;belongsTo('users')-&gt;localKey('author_id')-&gt;foreignKey('id')-&gt;setRelation();

/* relations for Tags table */
Relation::table('tags')-&gt;hasAndBelongsToMany('news')-&gt;localKey('id')-&gt;foreignKey('id')-&gt;setRelation();</code></pre>
        <hr />
        
        <h2 id="addData">Add some data</h2>
        <p>Put some data into tables</p>
        <h3>Users:</h3>
        <pre><code>$user = Lazer::table('users');

$user-&gt;name = 'John';
$user-&gt;email = 'john@example.com';
$user-&gt;save();

$user-&gt;name = 'Kriss';
$user-&gt;email = 'kriss@example.com';
$user-&gt;save();

$user-&gt;name = 'Larry';
$user-&gt;email = 'larry@example.com';
$user-&gt;save();

$user-&gt;name = 'Paul';
$user-&gt;email = 'paul@example.com';
$user-&gt;save();</code></pre>
        <h3>News:</h3>
        <pre><code>$news = Lazer::table('news');

$news-&gt;topic = 'Lorem ipsum';
$news-&gt;content = 'Lorem ipsum dolor sit amet enim. Etiam ullamcorper. Suspendisse a pellentesque dui, non felis. Maecenas malesuada elit lectus felis, malesuada ultricies. Curabitur et ligula. Ut molestie a, ultricies porta urna. Vestibulum commodo volutpat a, convallis ac, laoreet enim. Phasellus fermentum in, dolor.';
$news-&gt;author_id = 1; /* John */
$news-&gt;save();

$news-&gt;topic = 'Some breaking news';
$news-&gt;content = 'Some content of breaking news. Pellentesque facilisis. Nulla imperdiet sit amet magna. Vestibulum dapibus, mauris nec malesuada fames ac turpis velit, rhoncus eu.';
$news-&gt;author_id = 3; /* Larry */
$news-&gt;save();</code></pre>
        <hr />
        
        <h3>Tags:</h3>
        <pre><code>$tag = Lazer::table('tags');

$tag-&gt;name = 'news';
$tag-&gt;save();

$tag-&gt;name = 'breaking';
$tag-&gt;save();

$tag-&gt;name = 'lorem';
$tag-&gt;save();

$tag-&gt;name = 'ipsum';
$tag-&gt;save();</code></pre>
        <hr />
        
        <h3>Join tags to news:</h3>
        <pre><code>$tag_join = Lazer::table('news_tags');

$tag_join-&gt;news_id = 1; /* "Lorem..." news */
$tag_join-&gt;tags_id = 3; /* "lorem" tag */
$tag_join-&gt;save();

$tag_join-&gt;news_id = 1;
$tag_join-&gt;tags_id = 4; /* "ipsum" tag */
$tag_join-&gt;save();

$tag_join-&gt;news_id = 2; /* "Breaking..." news */
$tag_join-&gt;tags_id = 1; /* "news" tag */
$tag_join-&gt;save();

$tag_join-&gt;news_id = 2;
$tag_join-&gt;tags_id = 2; /* "breaking" tag */
$tag_join-&gt;save();</code></pre>
        <hr />
        
        <h3>Comments:</h3>
        <pre><code>$commment = Lazer::table('comments');

$commment-&gt;content = 'I wrote fantastic news';
$commment-&gt;author_id = 1; /* John */
$commment-&gt;news_id = 1; /* "Lorem..." news */
$commment-&gt;save();

$commment-&gt;content = 'Lorem ipsum';
$commment-&gt;author_id = 2; /* Kriss */
$commment-&gt;news_id = 1; /* "Lorem..." news */
$commment-&gt;save();

$commment-&gt;content = 'Terrible';
$commment-&gt;author_id = 4; /* Paul */
$commment-&gt;news_id = 2; /* "Breaking..." news */
$commment-&gt;save();</code></pre>
        <hr />
        
        <h2 id="finish">Finish, display it!:</h2>
        <h3>Code:</h3>
        <pre><code>$news = Lazer::table('news')-&gt;with('users')-&gt;with('tags')-&gt;with('comments')-&gt;with('comments:users')-&gt;findAll();

foreach($news as $post)
{
    echo '&lt;h1&gt;'.$post-&gt;topic.'&lt;/h1&gt;';
    echo '&lt;h4&gt;Author: '.$post-&gt;Users-&gt;name.'&lt;/h4&gt;';   
    echo '&lt;p&gt;'.$post-&gt;content.'&lt;/p&gt;';
    echo '&lt;small&gt;Tags: '.implode(', ', $post-&gt;Tags-&gt;findAll()-&gt;asArray(null, 'name')).'&lt;/small&gt;&lt;br /&gt;';
    echo '&lt;small&gt;Comments: '.$post-&gt;Comments-&gt;count().'&lt;/small&gt;';
    echo '&lt;ul&gt;';
    foreach($post-&gt;Comments-&gt;findAll() as $comment)
    {
        echo '&lt;li&gt;';
            echo '&lt;h5&gt;&lt;a href="mailto:'.$comment-&gt;Users-&gt;email.'"&gt;'.$comment-&gt;Users-&gt;name.'&lt;/a&gt;: &lt;/h5&gt;';
            echo '&lt;p&gt;"'.$comment-&gt;content.'"&lt;/p&gt;';
        echo '&lt;/li&gt;';
    }
    echo '&lt;/ul&gt;';
}</code></pre>
        <hr />
        
    </div>

</body>

</html>